<!DOCTYPE html>
<html lang="en">

<head>
    <title>WebClient</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"
        referrerpolicy="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <!-- See https://www.keycloak.org/docs/latest/securing_apps/#_javascript_adapter -->
    <script src="http://localhost:8080/auth/js/keycloak.js"></script>
    <script>
        let keycloak = null;
        let cyberchefUrlBase = "https://gchq.github.io/CyberChef/#recipe=JWT_Decode()&input=";

        //Credits: https://jsfiddle.net/magikMaker/7bjaT/
        function base64EncodeUrl(str) {
            return window.btoa(str).replace(/\+/g, '-').replace(/\//g, '_').replace(/\=+$/, '');
        }

        function initKC() {
            keycloak = new Keycloak({
                url: "http://localhost:8080/auth",
                realm: "demo",
                clientId: "demo"
            });

            keycloak.init().then(function (authenticated) {
                //See https://www.keycloak.org/docs/latest/securing_apps/#javascript-adapter-reference                
                let loginStateDiv = document.getElementById("loginState");
                let decodeAccessTokenLink = document.getElementById("decodeAccessTokenLink");
                loginStateDiv.innerText = "Anonymous";
                loginStateDiv.className = authenticated ? "alert alert-success" : "alert alert-secondary";
                if (authenticated) {
                    loginStateDiv.innerText = "Loading user profile...";
                    keycloak.loadUserProfile()
                        .then(function (profile) {
                            loginStateDiv.innerText = `Welcome user ${profile.username} !`;
                            decodeAccessTokenLink.href = cyberchefUrlBase + base64EncodeUrl(keycloak.token);
                            console.info("USER PROFILE:")
                            console.info(profile);
                        }).catch(function () {
                            alert("Failed to load user profile");
                        });
                    console.info("TOKENS:")
                    console.info(keycloak);
                }
            }).catch(function () {
                alert("Failed to initialize");
            });

            //See https://getbootstrap.com/docs/5.0/components/tooltips/#example-enable-tooltips-everywhere
            let tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            let tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })

        }

        function login() {
            //See https://www.keycloak.org/docs/latest/securing_apps/#login-options
            let options = {
                scope: "openid profile api"
            }
            keycloak.login(options);
        }

        function logout() {
            //See https://www.keycloak.org/docs/latest/securing_apps/#logout-options
            keycloak.logout();
        }
    </script>
</head>

<body onload="initKC()">
    <div class="container-lg">
        <div class="alert alert-primary" role="alert" id="loginState"></div>
        <button type="button" class="btn btn-primary" onclick="login()" data-bs-toggle="tooltip"
            title="Login user on Keycloak. Open developer Console to see tokens and profile information."
            data-bs-placement="top">Login</button>
        <button type="button" class="btn btn-primary" onclick="logout()" title="Logout user from Keycloak."
            data-bs-toggle="tooltip" data-bs-placement="top">Logout</button>
        <br />
        <a target="_blank" id="decodeAccessTokenLink"
            href="https://gchq.github.io/CyberChef/#recipe=JWT_Decode()&input=ZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJZ09pQWlTbGRVSWl3aWEybGtJaUE2SUNKRWFDMTRaWEpyYTA1NmQxUXhSbVZuUVVwT1psVnNObVpJV0ZwTGEzbENRMG8xVm5Sdk9GQlJlR2wzSW4wLmV5SmxlSEFpT2pFMk1qWXhNRE16TVRZc0ltbGhkQ0k2TVRZeU5qRXdNekF4Tml3aVlYVjBhRjkwYVcxbElqb3hOakkyTVRBeU9UazRMQ0pxZEdraU9pSmpOR0ZsTWpGaFppMWlNRE5oTFRRNVl6UXRZV0U1WWkxa09XWTVOMlZrTmpobE9URWlMQ0pwYzNNaU9pSm9kSFJ3T2k4dmJHOWpZV3hvYjNOME9qZ3dPREF2WVhWMGFDOXlaV0ZzYlhNdlpHVnRieUlzSW1GMVpDSTZJbUZqWTI5MWJuUWlMQ0p6ZFdJaU9pSTJOV0U1WVdKak5pMHpNVGMxTFRReE16RXRZVEpsWkMxaVl6Vm1NMkZqWXpnMlpXVWlMQ0owZVhBaU9pSkNaV0Z5WlhJaUxDSmhlbkFpT2lKa1pXMXZJaXdpYm05dVkyVWlPaUl6TW1GaVltVmxaQzFoWVRGakxUUXlOall0WWpsak1DMHdOR1k0TmpCak9UTTFaamNpTENKelpYTnphVzl1WDNOMFlYUmxJam9pWlRaaU1qYzVNREV0WldNMk1TMDBaRFptTFdFMU1ESXRNVFZsWW1ZeFpERTNZV1UxSWl3aVlXTnlJam9pTUNJc0ltRnNiRzkzWldRdGIzSnBaMmx1Y3lJNld5Sm9kSFJ3T2k4dmJHOWpZV3hvYjNOME9qazFNREFpWFN3aWNtVmhiRzFmWVdOalpYTnpJanA3SW5KdmJHVnpJanBiSW1SbFptRjFiSFF0Y205c1pYTXRjMkZ1WkdKdmVDSXNJbTltWm14cGJtVmZZV05qWlhOeklpd2lkVzFoWDJGMWRHaHZjbWw2WVhScGIyNGlYWDBzSW5KbGMyOTFjbU5sWDJGalkyVnpjeUk2ZXlKaFkyTnZkVzUwSWpwN0luSnZiR1Z6SWpwYkltMWhibUZuWlMxaFkyTnZkVzUwSWl3aWJXRnVZV2RsTFdGalkyOTFiblF0YkdsdWEzTWlMQ0oyYVdWM0xYQnliMlpwYkdVaVhYMTlMQ0p6WTI5d1pTSTZJbTl3Wlc1cFpDQmxiV0ZwYkNCd2NtOW1hV3hsSWl3aVpXMWhhV3hmZG1WeWFXWnBaV1FpT21aaGJITmxMQ0p1WVcxbElqb2laR1Z0YnlCa1pXMXZJaXdpY0hKbFptVnljbVZrWDNWelpYSnVZVzFsSWpvaVpHVnRieUlzSW1kcGRtVnVYMjVoYldVaU9pSmtaVzF2SWl3aVptRnRhV3g1WDI1aGJXVWlPaUprWlcxdkluMC5WXzhZNUtSdUp4R2QzcGtzNUxIcjdyM05KYlRRZ19FRHpEQ3RZQUcydHBFWlZ1bnlxWmZXd0tiZWRQcjhmTjVOWE5Ea2Faa3Q0R3J5cjVMQWRqZFhXNkpza1ZFREdrZ2U0TEdhT3JNZWF0cGlIVlZvZjc4SUxUMlZrcHl5MG5LWUtiY25fbXBvUkVJdXpINWFCVFJrR0tzWkhXcC0xLXZfaTZBZTBlZmVxZy15UTFxN05rMHc5VjFyeU9YUjR4UjFaRDFWZC1yeHlSTHVLRTZ5Ul9mVzFmQm9iZEkwbnNzRnZmMmZNM0l1QkUwOXZWTGpLU21IQ0hjZUxHcXMxX2ROclotYU9PUFhXYkdIX0VQQUxHR2YxMWtTN29ORTk3UmRvTkVaV2tOTDc4dW83dGxPZHkxbzJCV183VUg5cDIyOFFjRFRJSlVjVWxHSjZnQ0tyWXRiVGc">Decode
            Access Token</a>
    </div>
</body>

</html>